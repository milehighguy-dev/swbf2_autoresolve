---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Ben.
--- DateTime: 2/9/2024 4:23 PM
---

--TODO no modifications here.. sometimes wrong VO is played
-- something about ifs_freeform_main.defending is not correct

ifs_freeform_result.Enter = function(this, bFwd)
    gIFShellScreenTemplate_fnEnter(this, bFwd) -- call default enter function

    ifs_freeform_main:SetZoom(2)
    MoveCameraToEntity(ifs_freeform_main.planetSelected .. "_camera")
    SnapMapCamera()


    IFObj_fnSetVis(this.info, false)

    IFText_fnSetString(this.title.text, "ifs.freeform.battleresult")

    --		--display appropriate caption
    --		--if it's a space battle over a planet
    --		if ifs_freeform_main.planetFleet[ifs_freeform_main.planetSelected] == 0 then
    --			IFText_fnSetUString(this.title.text,
    --				ScriptCB_usprintf("ifs.freeform.resultstring",
    --					ScriptCB_getlocalizestr("planetname." .. ifs_freeform_main.planetSelected),
    --					ScriptCB_getlocalizestr("ifs.freeform.spacebattleresult")
    --				)
    --			)
    --		--if it's a planet or deep-space battle
    --		else
    --			IFText_fnSetUString(this.title.text,
    --				ScriptCB_usprintf("ifs.freeform.resultstring",
    --					ScriptCB_getlocalizestr("planetname." .. ifs_freeform_main.planetSelected),
    --					ScriptCB_getlocalizestr("ifs.freeform.battleresult")
    --				)
    --			)
    --		end

    ifs_freeform_SetButtonVis(this, "back", nil)
    ifs_freeform_SetButtonVis(this, "misc", nil)
    ifs_freeform_SetButtonName(this, "accept", "ifs.freeform.done")
    ifs_freeform_SetButtonVis(this, "help", nil)


    IFObj_fnSetVis(this.player, nil)

    if bFwd then
        -- if the active team won...
        print("DEBUG: RESULT player team is " .. tostring(ifs_freeform_main.playerTeam) ..
                " winner team is " .. tostring(ifs_freeform_main.winnerTeam) ..
                " joystick " .. tostring(ifs_freeform_main.joystick))
        if ifs_freeform_main.playerTeam == ifs_freeform_main.winnerTeam then
            -- if the battle was a fleet battle...
            if ifs_freeform_main.fleetBattle then
                -- play appropriate VO
                if ifs_freeform_main.joystick then
                    ifs_freeform_main:PlayVoice(string.format(ifs_result_fleet_won_sound, ifs_freeform_main.playerSide))
                else
                    ifs_freeform_main:PlayVoice(string.format(ifs_result_fleet_lost_sound, ifs_freeform_main.otherSide))
                end
            else
                -- play appropriate VO
                if ifs_freeform_main.joystick then
                    ifs_freeform_main:PlayVoice(string.format(ifs_result_planet_won_sound, ifs_freeform_main.playerSide, ifs_freeform_main.planetSelected))
                else
                    ifs_freeform_main:PlayVoice(string.format(ifs_result_planet_lost_sound, ifs_freeform_main.otherSide, ifs_freeform_main.planetSelected))
                end
            end
        else
            -- play appropriate VO
            if ifs_freeform_main.joystick then
                ifs_freeform_main:PlayVoice(string.format(ifs_result_fleet_lost_sound, ifs_freeform_main.playerSide))
            elseif ifs_freeform_main.fleetBattle then
                ifs_freeform_main:PlayVoice(string.format(ifs_result_fleet_defend_sound, ifs_freeform_main.otherSide))
            else
                ifs_freeform_main:PlayVoice(string.format(ifs_result_planet_defend_sound, ifs_freeform_main.otherSide, ifs_freeform_main.planetSelected))
            end
        end
    end

    -- update player results
    this:UpdateResult(this.player_result, ifs_freeform_main.playerTeam, ifs_freeform_main.joystick)
    this:UpdateResult(this.enemy_result, 3 - ifs_freeform_main.playerTeam, ifs_freeform_main.joystick_other)

    -- if in soak mode...
    if ifs_freeform_main.soakMode then
        -- start a display timer
        this.displayTimer = 5
    end

    -- prompt for save if necessary
    ifs_freeform_main:PromptSave()
end